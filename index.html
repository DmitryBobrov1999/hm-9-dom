<!DOCTYPE html>
<html>
	<head>
		<title>Проект "Комменты"</title>
		<meta charset="utf-8" />
		<link rel="stylesheet" href="styles.css" />
	</head>

	<body>
		<div class="container">
			<ul id="idComments" class="comments">
				<!-- <li class="comment">
					<div class="comment-header">
						<div>Глеб Фокин</div>
						<div>12.02.22 12:18</div>
					</div>
					<div class="comment-body">
						<div class="comment-text">
							Это будет первый комментарий на этой странице
						</div>
					</div>
					<div class="comment-footer">
						<div class="likes">
							<span class="likes-counter">3</span>
							<button class="like-button" data-show = ".like-button"></button>
						</div>
					</div>
				</li>
				<li id="idComment" class="comment">
					<div class="comment-header">
						<div id="idName">Варвара Н.</div>
						<div id="idDate">13.02.22 19:22</div>
					</div>
					<div class="comment-body">
						<div id="idCommentText" class="comment-text">
							Мне нравится как оформлена эта страница! ❤
						</div>
					</div>
					<div class="comment-footer">
						<div class="likes">
							<span class="likes-counter">75</span>
							<button class="like-button -active-like" data-show = '.-active-like'></button>
						</div>
					</div>
				</li> -->
			</ul>
			<div class="add-form">
				<input
					id="nameInput"
					type="text"
					class="add-form-name"
					placeholder="Введите ваше имя"
				/>
				<textarea
					id="textInput"
					type="textarea"
					class="add-form-text"
					placeholder="Введите ваш комментарий"
					rows="4"
				></textarea>
				<div class="add-form-row">
					<button id="add-form-button" class="add-form-button">Написать</button>
				</div>
			</div>
		</div>
	</body>

	<style>
		.error {
			background-color: rgb(221, 157, 157);
		}
	</style>

	<script>
		const buttonElement = document.getElementById('add-form-button');

		const listElement = document.getElementById('idComments');

		const buttonNameInput = document.getElementById('nameInput');

		const buttonTextInput = document.getElementById('textInput');

		const people = [
			{
				name: 'Глеб Фокин',
				text: 'Это будет первый комментарий на этой странице',
				date: '12.02.22 12:18',
				like: 3,
				isLike: '',
			},
			{
				name: 'Варвара Н.',
				text: 'Мне нравится как оформлена эта страница! ❤',
				date: '13.02.22 19:22',
				like: 75,
				isLike: '-active-like',
			},
		];

		const initEventListeners = () => {
			const buttonsLike = document.querySelectorAll('.like-button');
			for (const buttonLike of buttonsLike) {
				buttonLike.addEventListener('click', () => {
					if (buttonLike.classList.contains('-active-like')) {
						buttonLike.classList.remove('-active-like');
					} else {
						buttonLike.classList.add('-active-like');
					}

					const likesCounter = document.querySelectorAll('.likes-counter');

					for (const likeCounter of likesCounter) {
						count = likeCounter.innerHTML;
						if (buttonLike.classList.contains('-active-like')) {
							count++;
							likeCounter.innerHTML = count;
						} else {
							count--;
							likeCounter.innerHTML = count;
						} 
					}
				});
			}
		};


		const renderPeople = () => {
			const peopleHTML = people
				.map((man, index) => {
					return `<li class="comment" >
			        <div class="comment-header">
			          <div>${man.name}</div>
			          <div>${man.date}</div>
			        </div>
			        <div class="comment-body">
			            <div class="comment-text">
			              ${man.text}
			            </div>
			          </div>
			          <div class="comment-footer">
			            <div class="likes">
			              <span id='likes-counter' class="likes-counter">${man.like}</span>

			              <button data-index='${man.index}' id ='like-button' class="like-button ${man.isLike}"></button>

			            </div>
			          </div>
			      </li>`;
				})
				.join('');
			listElement.innerHTML = peopleHTML;

			initEventListeners();
			// likeMegaCounter();
		};

		renderPeople();

		const realDate = `${
			new Date().toLocaleDateString().slice(0, 6) +
			`${new Date().toLocaleDateString().slice(8)}`
		}  ${new Date().toLocaleTimeString().slice(0, -3)}`;

		buttonNameInput.addEventListener('keyup', enterFunction);

		function enterFunction(event) {
			if (event.key === 'Enter') {
				buttonElement.click();
			}
		}

		buttonElement.addEventListener('click', () => {
			buttonNameInput.addEventListener(
				'input',
				() => (buttonElement.disabled = false)
			);

			buttonTextInput.addEventListener(
				'input',
				() => (buttonElement.disabled = false)
			);

			buttonNameInput.classList.remove('error');
			buttonTextInput.classList.remove('error');

			if (buttonNameInput.value === '' && buttonTextInput.value === '') {
				buttonNameInput.classList.add('error');
				buttonTextInput.classList.add('error');
				buttonElement.disabled = true;
				return;
			}
			if (buttonNameInput.value === '') {
				buttonNameInput.classList.add('error');
				buttonElement.disabled = true;
				return;
			}
			if (buttonTextInput.value === '') {
				buttonTextInput.classList.add('error');
				buttonElement.disabled = true;
				return;
			}

			people.push({
				name: buttonNameInput.value,
				text: buttonTextInput.value,
				date: realDate,
				like: 0,
				isLike: '',
			});

			renderPeople();

			buttonNameInput.value = '';
			buttonTextInput.value = '';
		});
	</script>
</html>
